generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model Guild {
  id            String          @id
  name          String
  createdAt     DateTime        @default(now()) @map("created_at")
  GuildConfig   GuildConfig?
  GuildUser     GuildUser[]
  Todo          Todo[]
  LearningTopic LearningTopic[]

  @@map("guilds")
}

model GuildConfig {
  id              Int     @id @default(autoincrement())
  guildId         String  @unique @map("guild_id")
  prefix          String  @default("/")
  language        String  @default("en")
  learningEnabled Boolean @default(true) @map("learning_enabled")
  pomodoroEnabled Boolean @default(true) @map("pomodoro_enabled")
  Guild           Guild   @relation(fields: [guildId], references: [id])

  @@map("guild_configs")
}

model GuildUser {
  guildId  String   @map("guild_id")
  userId   String   @map("user_id")
  joinedAt DateTime @default(now()) @map("joined_at")
  User     User     @relation(fields: [userId], references: [id])
  Guild    Guild    @relation(fields: [guildId], references: [id])

  @@id([guildId, userId])
  @@map("guild_users")
}

model LearningPage {
  id              Int              @id @default(autoincrement())
  sectionId       Int              @map("section_id")
  slug            String
  title           String
  content         String
  emphasis        String?
  createdAt       DateTime         @default(now()) @map("created_at")
  LearningSection LearningSection  @relation(fields: [sectionId], references: [id])
  LearningReview  LearningReview[]

  @@unique([sectionId, slug])
  @@map("learning_pages")
}

model LearningReview {
  id             Int          @id @default(autoincrement())
  pageId         Int          @map("page_id")
  userId         String       @map("user_id")
  lastReviewedAt DateTime     @default(now()) @map("last_reviewed_at")
  nextReviewAt   DateTime?    @map("next_review_at")
  confidence     Int?
  User           User         @relation(fields: [userId], references: [id])
  LearningPage   LearningPage @relation(fields: [pageId], references: [id])

  @@unique([pageId, userId])
  @@map("learning_reviews")
}

model LearningSection {
  id            Int            @id @default(autoincrement())
  topicId       Int            @map("topic_id")
  slug          String
  title         String
  createdAt     DateTime       @default(now()) @map("created_at")
  LearningPage  LearningPage[]
  LearningTopic LearningTopic  @relation(fields: [topicId], references: [id])

  @@unique([topicId, slug])
  @@map("learning_sections")
}

model LearningTopic {
  id              Int               @id @default(autoincrement())
  userId          String?           @map("user_id")
  guildId         String?           @map("guild_id")
  slug            String
  title           String
  description     String?
  createdAt       DateTime          @default(now()) @map("created_at")
  LearningSection LearningSection[]
  User            User?             @relation(fields: [userId], references: [id])
  Guild           Guild?            @relation(fields: [guildId], references: [id])

  @@unique([slug, userId, guildId])
  @@map("learning_topics")
}

model Pomodoro {
  id          Int       @id @default(autoincrement())
  userId      String    @map("user_id")
  duration    Int
  startedAt   DateTime  @default(now()) @map("started_at")
  endedAt     DateTime? @map("ended_at")
  interrupted Boolean   @default(false)
  User        User      @relation(fields: [userId], references: [id])

  @@map("pomodoros")
}

model Standup {
  id      Int      @id @default(autoincrement())
  content String
  date    DateTime @default(now())
  userId  String   @map("user_id")
  guildId String?  @map("guild_id")
  User    User     @relation(fields: [userId], references: [id])

  @@map("standups")
}

model Todo {
  id          Int       @id @default(autoincrement())
  guildId     String?   @map("guild_id")
  userId      String    @map("user_id")
  title       String
  description String?
  done        Boolean   @default(false)
  createdAt   DateTime  @default(now()) @map("created_at")
  completedAt DateTime? @map("completed_at")
  Guild       Guild?    @relation(fields: [guildId], references: [id])
  User        User      @relation(fields: [userId], references: [id])

  @@map("todos")
}

model User {
  id             String           @id
  username       String
  avatar         String?
  createdAt      DateTime         @default(now()) @map("created_at")
  GuildUser      GuildUser[]
  LearningReview LearningReview[]
  LearningTopic  LearningTopic[]
  Pomodoro       Pomodoro[]
  Standup        Standup[]
  Todo           Todo[]
  UserSettings   UserSettings?

  @@map("users")
}

model UserSettings {
  id                   Int     @id @default(autoincrement())
  userId               String  @unique @map("user_id")
  language             String  @default("en")
  timezone             String  @default("UTC")
  notificationsEnabled Boolean @default(true) @map("notifications_enabled")
  User                 User    @relation(fields: [userId], references: [id])

  @@map("user_settings")
}
